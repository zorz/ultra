# Fixes for 2026-01-05

## UX

### High Priority

1. ✅ **FIXED** - Files like .git/config cause rendering issues where text from the config file isn't cleared when the user switches to a new tab, causing rendering issues. This also makes text hard/impossible to edit.

   **Root Cause:** The .git/config file uses literal tab characters (`\t`) for indentation. The DocumentEditor was rendering tabs as single characters instead of expanding them to multiple spaces based on the tabSize setting. This caused:
   - Text appearing compressed/misaligned
   - Cursor position not matching visual position
   - Mouse clicks not landing on the expected character
   - Stale artifacts when cursor moved

   **Solution:** Implemented proper tab expansion throughout DocumentEditor:
   1. Added helper methods for buffer/screen column conversion: `bufferColumnToScreenColumn()`, `screenColumnToBufferColumn()`, and `getTextScreenWidth()`
   2. Updated `renderLineWithTokens()` to expand tabs to the correct number of spaces based on column position and tabSize
   3. Added `renderLineWithTabExpansion()` for non-tokenized files (like .git/config) that also expands tabs properly
   4. Fixed cursor rendering to convert buffer column to screen column before drawing
   5. Fixed mouse click handling to convert screen column back to buffer column
   6. Fixed selection drag handling to use screen-to-buffer conversion
   7. Fixed selection highlight rendering to use screen columns
   8. Fixed search match highlight rendering to use screen columns
   9. Fixed diagnostic underline rendering to use screen columns
   10. Fixed `getLineWrapBreaks()` to calculate wrap positions using screen widths (accounting for tab expansion) instead of character counts
   11. Added `renderWrappedLineWithTabExpansion()` for word-wrapped, non-tokenized files
   12. Fixed `renderLineWithTokensWrapped()` to properly expand tabs in word-wrapped lines with syntax tokens

   **Files:**
   - `src/clients/tui/elements/document-editor.ts:1997-2034` (helper methods)
   - `src/clients/tui/elements/document-editor.ts:2521-2591` (getLineWrapBreaks with tab support)
   - `src/clients/tui/elements/document-editor.ts:2971-3033` (renderLineWithTokens)
   - `src/clients/tui/elements/document-editor.ts:3035-3089` (renderLineWithTabExpansion)
   - `src/clients/tui/elements/document-editor.ts:3091-3142` (renderWrappedLineWithTabExpansion)
   - `src/clients/tui/elements/document-editor.ts:3313-3378` (renderLineWithTokensWrapped)
   - `src/clients/tui/elements/document-editor.ts:2820-2834` (cursor rendering)
   - `src/clients/tui/elements/document-editor.ts:3730-3752` (selection drag)
   - `src/clients/tui/elements/document-editor.ts:3789-3830` (mouse click)
   - `src/clients/tui/elements/document-editor.ts:2892-2954` (diagnostic underlines)
   - `src/clients/tui/elements/document-editor.ts:3097-3143` (selection highlight)
   - `src/clients/tui/elements/document-editor.ts:3145-3193` (search match highlights)

2. ✅ **FIXED** - When making a new file in the file explorer pane, the key entry for the filename is captured by the pane's keyboard shortcuts - for example, a filename with the letter "d" will cause a delete prompt for the file in the list that has focus

   **Root Cause:** The `fileTreeFocus` keybinding context returned `true` even when the FileTree had an inline dialog open (new file, rename, etc.). Global keybindings are evaluated before element input handlers, so keybindings like `d` for delete were firing instead of allowing text input.

   **Solution:** Updated the `fileTreeFocus` context evaluation to check `isDialogOpen()`. When a dialog is open, the context returns `false`, preventing keybindings from triggering during text input.

   **File:** `src/clients/tui/client/tui-client.ts:3747-3755`

3. ✅ **FIXED** - Double clicking on a file in the source control pane opens the file instead of the diff. It should open the diff and this should be configurable in settings.

   **Root Cause:** The double-click handler in `GitPanel.handleMouse()` called `onOpenFile` instead of `onOpenDiff`.

   **Solution:** Changed double-click to call `onOpenDiff(path, isStaged)` instead of `onOpenFile(path)`. Also updated to use `TIMEOUTS.DOUBLE_CLICK` constant instead of hardcoded 300ms.

   **File:** `src/clients/tui/elements/git-panel.ts:647-660`

   **Note:** Settings configurability was not added in this fix - the default is now to open diff on double-click, which is the expected behavior.